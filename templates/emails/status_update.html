{% extends "emails/base_email.html" %}

{% block title %}Tilauksen päivitys - Levoro{% endblock %}

{% block header_class %}
{%- if new_status == 'NEW' -%}info
{%- elif new_status == 'CONFIRMED' -%}success
{%- elif new_status == 'IN_TRANSIT' -%}warning
{%- elif new_status == 'DELIVERED' -%}success
{%- elif new_status == 'CANCELLED' -%}danger
{%- else -%}info
{%- endif -%}
{% endblock %}

{% block header_title %}Tilauksen päivitys{% endblock %}

{% block header_subtitle %}
<div class="status-badge">{{ order.status }}</div>
{% endblock %}

{% block content %}
<h2>Hei {{ user_name }}!</h2>

<p>Tilauksesi tila on päivittynyt:</p>

<div style="text-align: center; margin: 24px 0;">
    {% if new_status == 'NEW' %}
    <span
        style="background: #3b82f6; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 600; display: inline-block;">UUSI</span>
    {% elif new_status == 'CONFIRMED' %}
    <span
        style="background: #10b981; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 600; display: inline-block;">VAHVISTETTU</span>
    {% elif new_status == 'ASSIGNED_TO_DRIVER' %}
    <span
        style="background: #f59e0b; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 600; display: inline-block;">NOUDOSSA</span>
    {% elif new_status == 'IN_TRANSIT' %}
    <span
        style="background: #f59e0b; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 600; display: inline-block;">KULJETUKSESSA</span>
    {% elif new_status == 'DELIVERED' %}
    <span
        style="background: #059669; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 600; display: inline-block;">TOIMITETTU</span>
    {% elif new_status == 'CANCELLED' %}
    <span
        style="background: #ef4444; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 600; display: inline-block;">PERUUTETTU</span>
    {% endif %}
</div>

<div class="info-box" style="background-color: #f3f4f6 !important; border-left: 4px solid #3b82f6 !important;">
    <strong style="color: #1f2937 !important;">{{ order.status }}</strong>
    <p style="color: #374151 !important;">{{ order.status_description }}</p>
</div>

<div class="details-card">
    <h3>Tilauksen tiedot</h3>

    <div class="detail-row">
        <div class="detail-label">Tilausnumero:</div>
        <div class="detail-value">#{{ order.order_id }}</div>
    </div>

    <div class="detail-row">
        <div class="detail-label">Nouto:</div>
        <div class="detail-value">{{ order.pickup_address }}</div>
    </div>

    <div class="detail-row">
        <div class="detail-label">Toimitus:</div>
        <div class="detail-value">{{ order.dropoff_address }}</div>
    </div>

    {% if order.vehicle_make and order.vehicle_model %}
    <div class="detail-row">
        <div class="detail-label">Ajoneuvo:</div>
        <div class="detail-value">{{ order.vehicle_make }} {{ order.vehicle_model }}</div>
    </div>
    {% endif %}

    {% if order.manual_pricing %}
    <div class="detail-row" style="padding-top: 16px; border-top: 2px solid #e5e7eb; margin-top: 12px;">
        <div class="detail-label">Hinta:</div>
        <div class="detail-value">Hinta sovitaan erikseen (beta)</div>
    </div>
{% elif order.price_gross %}
    <div class="detail-row" style="padding-top: 16px; border-top: 2px solid #e5e7eb; margin-top: 12px;">
        <div class="detail-label">Hinta:</div>
        <div class="detail-value">
            <strong style="font-size: 18px; color: #3b82f6;">
                {{ "%.2f"|format(order.price_gross / 1.255) }} €
            </strong>
            <span style="font-size: 13px; font-weight: 600; color: #6b7280;">ALV 0%</span>
        </div>
    </div>
    <div class="detail-row" style="padding: 4px 0; font-size: 12px; opacity: 0.7;">
        <div class="detail-label">ALV 25,5%:</div>
        <div class="detail-value">{{ "%.2f"|format(order.price_gross - (order.price_gross / 1.255)) }} €</div>
    </div>
    <div class="detail-row" style="padding: 4px 0 0 0; font-size: 12px; opacity: 0.7; border: none;">
        <div class="detail-label">Yhteensä sis. ALV:</div>
        <div class="detail-value">{{ "%.2f"|format(order.price_gross) }} €</div>
    </div>
    {% endif %}
</div>

{% if new_status == 'CONFIRMED' %}
<div class="info-box success" style="background-color: #f0fdf4 !important;">
    <strong style="color: #065f46 !important;">Vahvistettu</strong>
    <p style="color: #047857 !important;">Tilauksesi on vahvistettu ylläpidon toimesta ja odottaa noutopäivää.</p>
</div>
{% elif new_status == 'ASSIGNED_TO_DRIVER' %}
<div class="info-box warning" style="background-color: #fffbeb !important;">
    <strong style="color: #78350f !important;">Noudossa</strong>
    <p style="color: #92400e !important;">Ajoneuvosi haetaan pian - kuljettaja on matkalla noutopaikalle.</p>
</div>
{% elif new_status == 'IN_TRANSIT' %}
<div class="info-box warning" style="background-color: #fffbeb !important;">
    <strong style="color: #78350f !important;">Kuljetus käynnissä</strong>
    <p style="color: #92400e !important;">Autosi on nyt matkalla määränpäähän. Kuljettaja on yhteydessä kun saapuu
        toimituspaikkaan.</p>
</div>
{% elif new_status == 'DELIVERED' %}
<div class="info-box success" style="background-color: #f0fdf4 !important;">
    <strong style="color: #065f46 !important;">Toimitus valmis!</strong>
    <p style="color: #047857 !important;">Kiitos että valitsit Levoro-palvelun. Toivomme että olit tyytyväinen
        kuljetukseen!</p>
</div>
{% endif %}

<p><strong>Voit seurata tilauksen etenemistä:</strong><br>
    Kirjaudu sisään <a href="https://www.levoro.fi/login">www.levoro.fi</a> -sivustolla nähdäksesi ajantasaisen tilan.
</p>

<p>Jos sinulla on kysyttävää tilauksestasi, viittaa tilausnumeroon <strong>#{{ order.order_id }}</strong>.</p>

<p style="margin-top: 24px;">
    Ystävällisin terveisin,<br>
    <strong>Levoro-tiimi</strong>
</p>
{% endblock %}

{% block footer_note %}
Sait tämän viestin koska tilauksesi tila päivittyi. Tilausnumero: #{{ order.order_id }}
{% endblock %}