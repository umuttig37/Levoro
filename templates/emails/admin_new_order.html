{% extends "emails/base_email.html" %}

{% block title %}Uusi tilaus - Levoro{% endblock %}

{% block header_class %}warning{% endblock %}

{% block header_title %}Uusi tilaus saapunut{% endblock %}

{% block header_subtitle %}
<p>Tilaus odottaa vahvistusta</p>
<div class="status-badge">TILAUS #{{ order.id }}</div>
{% endblock %}

{% block content %}
<h2>Toimenpide vaaditaan</h2>

<p>Uusi kuljetustilaus on luotu ja odottaa admin-vahvistusta ennen kuljettajan määritystä.</p>

<div class="info-box warning">
    <strong>Muista vahvistaa tilaus</strong>
    <p>Tilaus näkyy kuljettajille vasta kun olet vahvistanut sen ja määrittänyt kuljettajan palkkion.</p>
</div>

<div class="details-card">
    <h3>Tilauksen tiedot</h3>

    <div class="detail-row">
        <div class="detail-label">Tilausnumero:</div>
        <div class="detail-value"><strong>#{{ order.id }}</strong></div>
    </div>

    <div class="detail-row">
        <div class="detail-label">Tila:</div>
        <div class="detail-value"><strong>{{ order.status }}</strong></div>
    </div>

    <div class="detail-row">
        <div class="detail-label">Asiakas:</div>
        <div class="detail-value">{{ customer.name if customer else 'Tuntematon' }}</div>
    </div>

    <div class="detail-row">
        <div class="detail-label">Sähköposti:</div>
        <div class="detail-value">{{ customer.email if customer else 'Ei tiedossa' }}</div>
    </div>

    <div class="detail-row">
        <div class="detail-label">Luotu:</div>
        <div class="detail-value">{{ order.created_at.strftime('%d.%m.%Y %H:%M') if order.created_at else 'Tuntematon'
            }}</div>
    </div>
</div>

<div class="info-box">
    <strong>Kuljetusreitti:</strong><br>
    <p style="margin: 8px 0 4px 0;">{{ order.pickup_address or 'Noutopaikka ei määritelty' }}</p>
    <p style="margin: 4px 0; font-weight: 600; color: #3b82f6;">↓</p>
    <p style="margin: 4px 0 0 0;">{{ order.dropoff_address or 'Toimituspaikka ei määritelty' }}</p>
</div>

{% if order.distance_km or order.price_gross %}
<div class="details-card">
    <h3>Hinnoittelutiedot</h3>
    {% if order.distance_km %}
    <div class="detail-row">
        <div class="detail-label">Matka:</div>
        <div class="detail-value">{{ "%.1f"|format(order.distance_km) }} km</div>
    </div>
    {% endif %}
    {% if order.price_gross %}
    <div class="detail-row">
        <div class="detail-label">Hinta (ALV 0%):</div>
        <div class="detail-value"><strong style="font-size: 1.5em; color: #0f172a;">{{ "%.2f"|format(order.price_gross /
                1.255) }} €</strong></div>
    </div>
    <div class="detail-row">
        <div class="detail-label">ALV 25,5%:</div>
        <div class="detail-value">{{ "%.2f"|format(order.price_gross - (order.price_gross / 1.255)) }} €</div>
    </div>
    <div class="detail-row">
        <div class="detail-label">Yhteensä sis. ALV:</div>
        <div class="detail-value"><strong>{{ "%.2f"|format(order.price_gross) }} €</strong></div>
    </div>
    {% endif %}
</div>
{% endif %}

{% if order.reg_number or order.winter_tires is not none or order.extras %}
<div class="details-card">
    <h3>Lisätiedot</h3>
    {% if order.reg_number %}
    <div class="detail-row">
        <div class="detail-label">Rekisterinumero:</div>
        <div class="detail-value">{{ order.reg_number }}</div>
    </div>
    {% endif %}
    {% if order.winter_tires is not none %}
    <div class="detail-row">
        <div class="detail-label">Talvirenkaat:</div>
        <div class="detail-value">{{ 'Kyllä' if order.winter_tires else 'Ei' }}</div>
    </div>
    {% endif %}
    {% if order.extras %}
    <div class="detail-row">
        <div class="detail-label">Lisätiedot:</div>
        <div class="detail-value">{{ order.extras }}</div>
    </div>
    {% endif %}
</div>
{% endif %}

<div class="info-box success">
    <strong>Seuraavat toimenpiteet</strong>
    <p>Vahvista tilaus admin-paneelissa, aseta kuljettajan palkkio ja määritä kuljettaja, jotta tilaus voi edetä.</p>
</div>

<div class="button-container">
    <a href="{{ admin_url }}" class="button">Avaa admin-paneeli</a>
    <a href="{{ order_detail_url }}" class="button success">Näytä tilaus</a>
</div>

<p><strong>Tärkeää:</strong> Muista tarkistaa tilauksen tiedot ja vahvistaa ne ennen kuljettajan määritystä.</p>
{% endblock %}

{% block footer_note %}
Tämä on automaattinen ilmoitus uudesta tilauksesta. Tilausnumero: #{{ order.id }}
{% endblock %}