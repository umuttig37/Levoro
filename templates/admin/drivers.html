{% extends "base/layout.html" %}
{% import 'components/icons.html' as icons %}

{% block title %}Kuljettajien hallinta – Admin{% endblock %}

{% block content %}
<div class="admin-container">
  <div class="admin-header">
    <h2>Kuljettajien hallinta</h2>
    <div class="admin-actions">
      <a class="btn btn-ghost" href="{{ url_for('main.admin_dashboard') }}">Takaisin tilauksiin</a>
      <a class="btn btn-ghost" href="{{ url_for('admin.users') }}">Käyttäjät</a>
      <a class="btn btn-secondary" href="{{ url_for('auth.logout') }}">Kirjaudu ulos</a>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  {% for category, message in messages %}
  <div class="alert alert-{% if category == 'error' %}danger{% else %}{{ category }}{% endif %} mb-4">
    {{ message }}
  </div>
  {% endfor %}
  {% endif %}
  {% endwith %}

  <!-- Driver Statistics -->
  <div class="mb-6">
    <h3>Kuljettajat</h3>
    <table class="admin-table admin-users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nimi</th>
          <th>Sähköposti</th>
          <th>Tila</th>
          <th>Yhteensä</th>
          <th>Suoritettu</th>
          <th>Aktiivisia</th>
          <th>Luotu</th>
          <th>Toiminnot</th>
        </tr>
      </thead>
      <tbody>
        {% if drivers_performance %}
        {% for driver in drivers_performance %}
        {% set status_class = 'status-confirmed' if driver.get('status') == 'active' else 'status-new' %}
        {% set status_text = '✓ Aktiivinen' if driver.get('status') == 'active' else '- Odottaa' %}
        <tr>
          <td>#{{ driver.id }}</td>
          <td>{{ driver.name }}</td>
          <td>{{ driver.email }}</td>
          <td><span class="status {{ status_class }}">{{ status_text }}</span></td>
          <td>{{ driver.total_jobs }}</td>
          <td>{{ driver.completed_jobs }}</td>
          <td>{{ driver.active_jobs }}</td>
          <td>{{ driver.created_at | helsinki_time if driver.created_at else '-' }}</td>
          <td>
            <form method="POST" action="{{ url_for('admin.delete_driver', driver_id=driver.id) }}"
                  onsubmit="return confirm('Haluatko varmasti poistaa kuljettajan {{ driver.name }}? Tätä toimintoa ei voi peruuttaa.');"
                  style="display: inline;">
              <button type="submit"
                      class="btn btn-sm btn-danger"
                      {% if driver.active_jobs > 0 %}
                      title="Kuljettajalla on aktiivisia tilauksia, ei voi poistaa"
                      disabled
                      {% endif %}>
                {{ icons.alert(16, '#fff', 'icon-inline') }} Poista
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="9" class="muted">Ei kuljettajia</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}