{% extends "base/layout.html" %}

{% block title %}Kuljettajien hallinta – Admin{% endblock %}

{% block content %}
<div class="admin-container">
  {% include "admin/navigation.html" %}

  <p class="admin-description">Hallinnoi kuljettajia ja heidän suorituskykytilastojaan.</p>

  <div class="admin-table-card">
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nimi</th>
          <th>Sähköposti</th>
          <th>Tila</th>
          <th>Yhteensä</th>
          <th>Suoritettu</th>
          <th>Aktiivisia</th>
          <th>Luotu</th>
          <th>Toiminnot</th>
        </tr>
      </thead>
      <tbody>
        {% if drivers_performance %}
        {% for driver in drivers_performance %}
        {% set status_class = 'admin-status-active' if driver.get('status') == 'active' else 'admin-status-pending' %}
        {% set status_text = 'Aktiivinen' if driver.get('status') == 'active' else 'Odottaa' %}
        <tr>
          <td><strong>#{{ driver.id }}</strong></td>
          <td>{{ driver.name }}</td>
          <td>{{ driver.email }}</td>
          <td><span class="admin-status {{ status_class }}">{{ status_text }}</span></td>
          <td>{{ driver.total_jobs }}</td>
          <td>{{ driver.completed_jobs }}</td>
          <td>{{ driver.active_jobs }}</td>
          <td>{{ driver.created_at | helsinki_time if driver.created_at else '-' }}</td>
          <td>
            <form method="POST" action="{{ url_for('admin.delete_driver', driver_id=driver.id) }}"
              onsubmit="return confirm('Haluatko varmasti poistaa kuljettajan {{ driver.name }}?');"
              style="display: inline;">
              <button type="submit" class="admin-btn admin-btn-danger admin-btn-sm" {% if driver.active_jobs> 0 %}
                title="Kuljettajalla on aktiivisia tilauksia"
                disabled
                {% endif %}>
                Poista
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="9">
            <div class="admin-empty">
              <div class="admin-empty-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
              </div>
              <h3>Ei kuljettajia</h3>
              <p>Kuljettajia ei ole vielä rekisteröity.</p>
            </div>
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}