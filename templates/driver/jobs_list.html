{% extends "base/layout.html" %}
{% import 'components/icons.html' as icons %}

{% block title %}Saatavilla olevat työt{% endblock %}

{% block content %}
<div class="container">
  <div class="section-padding">
    <div class="text-center mb-8">
      <h1 class="calculator-title">Saatavilla olevat työt</h1>
      <p class="calculator-subtitle">Valitse työ jonka haluat ottaa vastaan</p>
    </div>
  </div>

  <div class="mb-4">
    <a href="{{ url_for('driver.dashboard') }}" class="btn btn-ghost">← Takaisin työpöydälle</a>
  </div>

  {% if available_jobs %}
  <div class="grid gap-6">
    {% for job in available_jobs %}
    <div class="card">
      <div class="card-header">
        <div class="flex justify-between items-start">
          <div>
            <h3 class="card-title">Tilaus #{{ job.id }}</h3>
            <p class="card-subtitle">Luotu: {{ job.created_at|helsinki_time if job.created_at else 'Tuntematon' }}</p>
          </div>
          <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
            Saatavilla
          </span>
        </div>
      </div>

      <div class="card-body">
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold mb-2">Reittitiedot</h4>
            <div class="space-y-2 text-sm">
              <div>
                <span class="font-medium">Nouto:</span>
                <span class="text-gray-600">{{ job.pickup_address|extract_city }}</span>
              </div>
              <div>
                <span class="font-medium">Toimitus:</span>
                <span class="text-gray-600">{{ job.dropoff_address|extract_city }}</span>
              </div>
              <div>
                <span class="font-medium">Matka:</span>
                <span class="text-gray-600">{{ job.distance_km|default(0)|round(1) }} km</span>
              </div>
            </div>
          </div>

          <div>
            <h4 class="font-semibold mb-2">Tilaustiedot</h4>
            <div class="space-y-2 text-sm">
              <div>
                <span class="font-medium">Palkkio:</span>
                <span class="text-gray-600"><strong style="font-size: 1.15em; color: #059669;">{% if job.driver_reward
                    %}{{ job.driver_reward|round(2) }}{% else %}0.00{% endif %} €</strong></span>
              </div>
              {# Vehicle info hidden until job accepted #}
              {% if job.pickup_date %}
              <div>
                <span class="font-medium">Noutopäivä:</span>
                <span class="text-gray-600">{{ job.pickup_date }}</span>
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        {% if job.extras %}
        <div class="mt-4">
          <h4 class="font-semibold mb-2">Lisätiedot</h4>
          <p class="text-sm text-gray-600">{{ job.extras }}</p>
        </div>
        {% endif %}

        <div class="mt-6">
          <div class="flex gap-3">
            <a href="{{ url_for('driver.job_detail', order_id=job.id) }}" class="btn btn-primary">Katso
              yksityiskohdat</a>
            <form method="POST" action="{{ url_for('driver.accept_job', order_id=job.id) }}" style="display: inline;">
              <button type="submit" class="btn btn-secondary"
                onclick="return confirm('Haluatko varmasti ottaa tämän työn vastaan?')">
                Ota työ vastaan
              </button>
            </form>
          </div>
          <p class="text-xs text-muted mt-2">Ajoneuvon tiedot ja tarkat osoitteet tulevat näkyviin kun kuitattu napilla
            olevan paikalla</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-12">
    <div style="margin-bottom: 1rem;">{{ icons.package(64, '#94a3b8') }}</div>
    <h3 style="margin-bottom: 0.5rem;">Ei saatavilla olevia töitä</h3>
    <p style="color: #6b7280;">Kaikki työt on jo otettu vastaan tai tilauksia ei ole saatavilla</p>
    <div class="mt-6">
      <a href="{{ url_for('driver.dashboard') }}" class="btn btn-primary">Takaisin työpöydälle</a>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}